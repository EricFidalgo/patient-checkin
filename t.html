<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coverage Clarity | 2025 GLP-1 Benefit Verification</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass-blur { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(8px); }
        .pulse-ring { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: .5; transform: scale(1.05); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen flex flex-col">

    <nav class="p-4 border-b bg-white">
        <div class="max-w-4xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-2 font-bold text-blue-600 text-xl">
                <i data-lucide="shield-check"></i> VeriScript Network
            </div>
            <div class="text-xs font-medium text-slate-500 uppercase tracking-widest">Clinical Benefit Engine v2.5</div>
        </div>
    </nav>

    <main class="flex-grow flex items-center justify-center p-4">
        <div id="app-container" class="w-full max-w-xl bg-white rounded-2xl shadow-xl border border-slate-200 overflow-hidden">
            
            <section id="step-intake" class="p-8">
                <div class="mb-8 text-center">
                    <h1 class="text-2xl font-bold text-slate-900">Check Your 2025 GLP-1 Coverage</h1>
                    <p class="text-slate-500">Real-time formulary analysis in 60 seconds.</p>
                </div>

                <form id="intake-form" class="space-y-6">
                    <div>
                        <label class="block text-sm font-semibold mb-2">Prescribed Medication</label>
                        <select id="medication" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-600 outline-none transition" required>
                            <option value="">Select Medication...</option>
                            <option>Wegovy</option>
                            <option>Zepbound</option>
                            <option>Mounjaro</option>
                            <option>Ozempic</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold mb-2">Current BMI</label>
                            <input type="number" id="bmi" placeholder="e.g. 30" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-600 outline-none" required min="10" max="70">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold mb-2">Insurance Carrier</label>
                            <select id="carrier" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-600 outline-none" required>
                                <option value="">Select Carrier...</option>
                                <option value="Aetna">Aetna</option>
                                <option value="Blue Cross Blue Shield">Blue Cross Blue Shield</option>
                                <option value="Cigna">Cigna</option>
                                <option value="UnitedHealthcare">UnitedHealthcare</option>
                                <option value="Medicare/Medicaid">Medicare/Medicaid</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold mb-3">Existing Conditions (Select all that apply)</label>
                        <div class="grid grid-cols-2 gap-2 text-sm">
                            <label class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" name="comorbidity" value="High Blood Pressure"> High Blood Pressure
                            </label>
                            <label class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" name="comorbidity" value="High Cholesterol"> High Cholesterol
                            </label>
                            <label class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" name="comorbidity" value="Sleep Apnea"> Sleep Apnea
                            </label>
                            <label class="flex items-center gap-2 p-2 border rounded hover:bg-slate-50 cursor-pointer">
                                <input type="checkbox" name="comorbidity" value="Type 2 Diabetes"> Type 2 Diabetes
                            </label>
                        </div>
                    </div>

                    <div class="relative">
                        <label class="block text-sm font-semibold mb-2 flex items-center gap-2">
                            Member ID (Optional)
                            <div class="group relative">
                                <i data-lucide="info" class="w-4 h-4 text-slate-400 cursor-help"></i>
                                <div class="absolute bottom-full mb-2 left-0 w-64 p-2 bg-slate-800 text-white text-xs rounded hidden group-hover:block z-50">
                                    Providing your ID allows our pharmacists to pull your exact 2025 copay. Without it, we provide a highly accurate estimate.
                                </div>
                            </div>
                        </label>
                        <input type="text" id="member-id" placeholder="ID on your insurance card" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-600 outline-none">
                    </div>

                    <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl transition-all transform active:scale-95 shadow-lg shadow-blue-200">
                        Check Coverage
                    </button>
                </form>
            </section>

            <section id="step-loading" class="hidden p-12 text-center">
                <div class="flex flex-col items-center justify-center space-y-8 py-10">
                    <div class="relative">
                        <div class="w-20 h-20 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"></div>
                        <i data-lucide="activity" class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-blue-600 w-8 h-8 pulse-ring"></i>
                    </div>
                    <div class="space-y-2">
                        <p id="loading-text" class="text-lg font-medium text-slate-700">Accessing 2025 Payer Formularies...</p>
                        <div class="w-48 h-1.5 bg-slate-100 rounded-full mx-auto overflow-hidden">
                            <div class="h-full bg-blue-600 animate-[loading_4s_ease-in-out]"></div>
                        </div>
                    </div>
                </div>
            </section>

            <section id="step-email" class="hidden p-8">
                <div class="text-center mb-6">
                    <div class="inline-flex items-center justify-center w-16 h-16 bg-emerald-100 text-emerald-600 rounded-full mb-4">
                        <i data-lucide="lock" class="w-8 h-8"></i>
                    </div>
                    <h2 class="text-2xl font-bold">Analysis Complete</h2>
                    <p class="text-slate-500">We found a potential coverage pathway.</p>
                </div>
                
                <div class="bg-slate-50 p-6 rounded-xl border border-dashed border-slate-300 mb-6">
                    <p class="text-sm text-slate-600 leading-relaxed italic">
                        "Your profile has been processed against the 2025 clinical criteria for <span id="display-carrier" class="font-bold"></span>. We have generated a Fee Report and identified local inventory."
                    </p>
                </div>

                <form id="email-gate-form" class="space-y-4">
                    <input type="email" id="user-email" placeholder="Enter your email to unlock" class="w-full p-4 border rounded-xl outline-none focus:ring-2 focus:ring-blue-600" required>
                    
                    <label class="flex items-start gap-3 p-3 bg-blue-50/50 rounded-lg cursor-pointer">
                        <input type="checkbox" id="hipaa-check" class="mt-1 w-5 h-5 rounded border-blue-300" required>
                        <span class="text-xs text-slate-600">
                            I authorize VeriScript Network to disclose my health profile to its pharmacy network to verify benefits under HIPAA. I agree to receive SMS/Email alerts.
                        </span>
                    </label>

                    <button type="submit" id="unlock-btn" disabled class="w-full bg-blue-600 disabled:bg-slate-300 text-white font-bold py-4 rounded-xl transition-all">
                        View Results
                    </button>
                </form>
            </section>

            <section id="step-results" class="hidden p-8">
                <div id="result-card" class="rounded-2xl p-8 text-center border-2">
                    </div>
            </section>
        </div>
    </main>

    <footer class="p-8 bg-white border-t mt-12">
        <div class="max-w-4xl mx-auto text-center">
            <p class="text-xs text-slate-400 leading-relaxed">
                This tool provides an estimate based on 2025 formulary data. Final coverage is determined by your insurer. This is not a guarantee of payment. VeriScript operates as a clinical intermediary.
            </p>
            <div class="mt-4 flex justify-center gap-4 text-[10px] text-slate-400 uppercase tracking-widest font-bold">
                <span>HIPAA Compliant</span>
                <span>•</span>
                <span>AES-256 Encrypted</span>
                <span>•</span>
                <span>2025 Updated</span>
            </div>
        </div>
    </footer>

    <script>
        // DOM Elements
        const intakeForm = document.getElementById('intake-form');
        const emailForm = document.getElementById('email-gate-form');
        const hipaaCheck = document.getElementById('hipaa-check');
        const unlockBtn = document.getElementById('unlock-btn');
        
        const steps = {
            intake: document.getElementById('step-intake'),
            loading: document.getElementById('step-loading'),
            email: document.getElementById('step-email'),
            results: document.getElementById('step-results')
        };

        let userData = {};

        // Lucide Init
        lucide.createIcons();

        // HIPAA Check logic
        hipaaCheck.addEventListener('change', (e) => {
            unlockBtn.disabled = !e.target.checked;
        });

        // Form Submit Step 1
        intakeForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Gather Data
            const selectedComorbidities = Array.from(document.querySelectorAll('input[name="comorbidity"]:checked')).map(el => el.value);
            
            userData = {
                medication: document.getElementById('medication').value,
                bmi: parseFloat(document.getElementById('bmi').value),
                carrier: document.getElementById('carrier').value,
                comorbidities: selectedComorbidities,
                memberId: document.getElementById('member-id').value
            };

            // Logic Rule 1: The Hard Red (Immediate Disqualification)
            if (userData.carrier === "Medicare/Medicaid" || userData.bmi < 25) {
                alert("Insurance Notice: Medicare/Medicaid plans currently do not cover GLP-1 medications for weight loss in 2025, and a minimum BMI of 25 is required for clinical consideration.");
                return;
            }

            transitionToLoading();
        });

        function transitionToLoading() {
            steps.intake.classList.add('hidden');
            steps.loading.classList.remove('hidden');

            const loadingMessages = [
                "Accessing 2025 Payer Formularies...",
                "Comparing BMI against FDA Clinical Guidelines...",
                "Calculating Prior Authorization Probability...",
                "Generating Fee Report..."
            ];

            let msgIndex = 0;
            const msgEl = document.getElementById('loading-text');
            
            const interval = setInterval(() => {
                msgIndex++;
                if (msgIndex < loadingMessages.length) {
                    msgEl.innerText = loadingMessages[msgIndex];
                }
            }, 1200);

            setTimeout(() => {
                clearInterval(interval);
                showEmailGate();
            }, 4000);
        }

        function showEmailGate() {
            steps.loading.classList.add('hidden');
            steps.email.classList.remove('hidden');
            document.getElementById('display-carrier').innerText = userData.carrier;
        }

        emailForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            /* SECURITY NOTE: 
               This is where the POST request would occur.
               Data would be encrypted via AES-256 before being sent to the backend.
               Example: const encryptedBody = encrypt(userData, publicKey);
            */
            
            showResults();
        });

        function calculateHeuristic() {
            const { bmi, comorbidities, carrier } = userData;
            
            // Logic Rule 3b: Specific strict carriers (UHC/Cigna)
            if (carrier === "UnitedHealthcare" || carrier === "Cigna") {
                return 'YELLOW';
            }

            // Logic Rule 2: Green Light
            if (bmi >= 30 || (bmi >= 27 && comorbidities.length > 0)) {
                return 'GREEN';
            }

            // Logic Rule 3a: Grey Light
            if (bmi >= 27 && bmi <= 29 && comorbidities.length === 0) {
                return 'GREY';
            }

            return 'GREY'; // Default fallback
        }

        function showResults() {
            steps.email.classList.add('hidden');
            steps.results.classList.remove('hidden');
            
            const resultType = calculateHeuristic();
            const container = document.getElementById('result-card');
            
            const templates = {
                GREEN: {
                    class: "border-emerald-500 bg-emerald-50/50",
                    icon: "shield-check",
                    iconClass: "text-emerald-600",
                    headline: "MATCH FOUND: HIGH PROBABILITY",
                    body: `Your profile aligns with current ${userData.carrier} approval criteria. Estimated Copay: $25.00.`,
                    button: "Schedule Your 5-Minute Clinical Intake",
                    subtext: "Inventory Reserved for 24 hours"
                },
                YELLOW: {
                    class: "border-amber-500 bg-amber-50/50",
                    icon: "alert-triangle",
                    iconClass: "text-amber-600",
                    headline: "ACTION REQUIRED: PRIOR AUTHORIZATION",
                    body: `Coverage is possible, but ${userData.carrier} requires 'Prior Authorization' paperwork (Step Therapy/Diet History). Our VeriScript team handles this bureaucracy for you.`,
                    button: "Start My Appeal/Intake Process",
                    subtext: "Clinical Specialists Standing By"
                },
                GREY: {
                    class: "border-slate-400 bg-slate-50",
                    icon: "refresh-ccw",
                    iconClass: "text-blue-600 animate-spin-slow",
                    headline: "PENDING: SPECIALIST VERIFICATION REQUIRED",
                    body: `Your profile is unique. Due to volatile 2025 insurance rules for ${userData.carrier}, a human pharmacist must manually verify your documentation to maximize coverage. Do not close this page.`,
                    button: "Request Priority Review",
                    subtext: "Average human response time: 4 minutes"
                }
            };

            const config = templates[resultType];
            container.className = `rounded-2xl p-8 text-center border-2 ${config.class}`;
            
            container.innerHTML = `
                <div class="flex justify-center mb-4">
                    <i data-lucide="${config.icon}" class="w-16 h-16 ${config.iconClass}"></i>
                </div>
                <h2 class="text-2xl font-black mb-2">${config.headline}</h2>
                <p class="text-slate-600 mb-8 leading-relaxed">${config.body}</p>
                <a href="#" class="inline-block w-full bg-slate-900 text-white font-bold py-4 rounded-xl hover:bg-black transition-colors">
                    ${config.button}
                </a>
                <p class="mt-4 text-xs font-bold uppercase tracking-widest text-slate-400">${config.subtext}</p>
            `;
            
            lucide.createIcons();
        }
    </script>

    <style>
        @keyframes loading {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        .animate-spin-slow {
            animation: spin 3s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
    </style>
</body>
</html>